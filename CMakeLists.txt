cmake_minimum_required(VERSION 3.13.4)

project(windscribe-desktop-app
  VERSION 2.4.11
  DESCRIPTION "desktop app for Windscribe VPN"
  HOMEPAGE_URL "https://github.com/Windscribe/Desktop-App"
  LANGUAGES CXX
)

set(CMAKE_CXX_STANDARD 11)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_CXX_VISIBILITY_PRESET hidden) # perf
set(CMAKE_VISIBILITY_INLINES_HIDDEN ON) # perf

# breaks with -pedantic: error: ISO C++ prohibits anonymous structs
# beaks with -Werror: error: unused parameter ‘helper’ [-Werror=unused-parameter]
add_compile_options(-Wall -Wextra -O1)

include(GNUInstallDirs)

# https://gitlab.kitware.com/cmake/community/-/wikis/doc/tutorials/How-To-Write-Platform-Checks
# add_definitions is recursive for all targets
if(CMAKE_SYSTEM_NAME STREQUAL "Linux")
  add_definitions(-D"__LINUX__")
elseif(CMAKE_SYSTEM_NAME STREQUAL "Windows")
  add_definitions(-D"__WINDOWS__")
elseif(CMAKE_SYSTEM_NAME STREQUAL "Darwin")
  add_definitions(-D"__APPLE__")
endif()

# TODO boost version?
#find_package(Boost 1.36.0 REQUIRED COMPONENTS serialization filesystem)
find_package(Boost REQUIRED COMPONENTS serialization filesystem)
include_directories(${Boost_INCLUDE_DIRS}) 

find_package(OpenSSL REQUIRED)
include_directories(${OpenSSL_INCLUDE_DIRS}) 

# key_pub.txt is generated by build_all.py from key.pub
option(use_signature_check "Sign this build with key_pub.txt" OFF)

add_subdirectory(backend/linux/helper)
add_subdirectory(common/ipc/proto)
add_subdirectory(client)
